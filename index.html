<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, nosnippet, noarchive">
    <title>æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2c5aa0;
            margin-bottom: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .text-input {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            resize: vertical;
            font-family: inherit;
        }

        .text-input:focus {
            outline: none;
            border-color: #2c5aa0;
        }

        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #2c5aa0;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .char-types {
            background: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }

        .word-analysis {
            background: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }

        .char-types h3, .word-analysis h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
            text-align: center;
        }

        .char-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .word-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f1f3f4;
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-item:nth-child(even) {
            background-color: #f8f9fa;
        }

        .word-text {
            font-weight: 500;
            color: #333;
        }

        .word-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }

        .word-count {
            color: #2c5aa0;
            font-weight: bold;
        }

        .word-percent {
            color: #666;
        }

        .word-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .word-controls label {
            color: #666;
            font-size: 0.9rem;
        }

        .word-controls input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .word-controls select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .no-words {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .char-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e9ecef;
        }

        .char-count {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c5aa0;
        }

        .char-percent {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }

        .char-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c5aa0;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .clear-btn:hover {
            background: #c82333;
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒªã‚¢ */
        .file-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .file-section h2 {
            color: #2c5aa0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .file-section h2 i {
            margin-right: 10px;
        }

        .file-drop-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .file-drop-area:hover {
            border-color: #2c5aa0;
            background-color: #f8f9fa;
        }

        .file-drop-area.drag-over {
            border-color: #2c5aa0;
            background-color: #e3f2fd;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #666;
            border-left: 4px solid #17a2b8;
        }

        .file-info ul {
            margin: 10px 0 0 20px;
            padding: 0;
        }

        .file-info li {
            margin: 5px 0;
        }

        .file-size-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
        }

        .file-size-warning .size-limit {
            font-size: 1.2rem;
            font-weight: bold;
            color: #856404;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .file-size-warning .size-note {
            font-size: 0.9rem;
            color: #664d03;
            margin-top: 5px;
        }

        .file-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .file-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .file-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .file-status.processing {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f1f3f4;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #2c5aa0;
            width: 0%;
            transition: width 0.3s ease;
        }

        .btn-file {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-file:hover {
            background: #138496;
        }

        .current-file {
            margin-top: 10px;
            padding: 8px 12px;
            background: #e3f2fd;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #1976d2;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œç‰ˆï¼‰</h1>
        
        <!-- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="file-section">
            <h2><i class="fas fa-file-import"></i> ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿</h2>
            <div class="file-drop-area" id="fileDropArea">
                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #2c5aa0; margin-bottom: 10px;"></i>
                <p><strong>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</strong></p>
                <p>ã¾ãŸã¯</p>
                <button class="btn-file" id="fileSelectBtn">
                    <i class="fas fa-folder-open"></i>
                    ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                </button>
                <input type="file" id="fileInput" class="file-input" accept=".txt,.pdf,.docx" multiple>
            </div>
            
            <div class="file-size-warning">
                <div class="size-limit">
                    <i class="fas fa-exclamation-triangle"></i>
                    æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 10MB
                </div>
                <div class="size-note">
                    ã“ã‚Œã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‡¦ç†ã§ãã¾ã›ã‚“
                </div>
            </div>
            
            <div class="file-info">
                <strong><i class="fas fa-info-circle"></i> å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒ»åˆ¶é™</strong>
                <ul>
                    <li><strong>å¯¾å¿œå½¢å¼:</strong> .txtï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã€.pdfï¼ˆPDFãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã€.docxï¼ˆWordæ–‡æ›¸ï¼‰</li>
                    <li><strong>PDFåˆ¶é™:</strong> ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®PDFã®ã¿ï¼ˆç”»åƒãƒ»ã‚¹ã‚­ãƒ£ãƒ³PDFã¯éå¯¾å¿œï¼‰</li>
                    <li><strong>Wordåˆ¶é™:</strong> .docxå½¢å¼ã®ã¿ï¼ˆæ—§.docå½¢å¼ã¯éå¯¾å¿œï¼‰ã€ãƒ†ã‚­ã‚¹ãƒˆã®ã¿æŠ½å‡º</br>ï¼ˆWordä¸Šã®ãƒ›ãƒ¼ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰è¨­å®šã—ãŸæ®µè½ç•ªå·ã‚„ç®‡æ¡æ›¸ãã®ãƒ†ã‚­ã‚¹ãƒˆã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã›ã‚“ï¼‰</li>
                    <li><strong>æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°:</strong> UTF-8ã€Shift-JISè‡ªå‹•åˆ¤å®š</li>
                </ul>
            </div>

            <div class="file-status" id="fileStatus"></div>
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="current-file" id="currentFile"></div>
        </div>

        <div class="input-section">
            <h2><i class="fas fa-edit"></i> ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›</h2>
            <textarea 
                id="textInput" 
                class="text-input" 
                placeholder="ã“ã“ã«æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ä¸Šã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„...&#10;&#10;å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«ï¼š&#10;ãƒ».txtï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰&#10;ãƒ».pdfï¼ˆPDFãƒ•ã‚¡ã‚¤ãƒ«ï¼‰&#10;ãƒ».docxï¼ˆWordæ–‡æ›¸ï¼‰&#10;&#10;ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ–‡å­—æ•°ãƒ»æ–‡å­—ç¨®åˆ¥ãƒ»å˜èªåˆ†æã‚’å®Ÿè¡Œã—ã¾ã™ã€‚"
            ></textarea>
            <button id="clearBtn" class="clear-btn">ã‚¯ãƒªã‚¢</button>
        </div>

        <div class="results">
            <div class="stat-grid">
                <div class="stat-item">
                    <span class="stat-value" id="totalChars">0</span>
                    <div class="stat-label">ç·æ–‡å­—æ•°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="noSpaceChars">0</span>
                    <div class="stat-label">ç©ºç™½é™¤ã</div>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="noBreakChars">0</span>
                    <div class="stat-label">æ”¹è¡Œé™¤ã</div>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="lineCount">0</span>
                    <div class="stat-label">è¡Œæ•°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="byteCount">0</span>
                    <div class="stat-label">ãƒã‚¤ãƒˆæ•°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="readTime">0</span>
                    <div class="stat-label">èª­äº†æ™‚é–“(åˆ†)</div>
                </div>
            </div>

            <div class="char-types">
                <h3>æ–‡å­—ç¨®åˆ¥åˆ†æ</h3>
                <div class="char-grid">
                    <div class="char-item">
                        <div class="char-count" id="hiraganaCount">0</div>
                        <div class="char-percent" id="hiraganaPercent">0%</div>
                        <div class="char-label">ã²ã‚‰ãŒãª</div>
                    </div>
                    <div class="char-item">
                        <div class="char-count" id="katakanaCount">0</div>
                        <div class="char-percent" id="katakanaPercent">0%</div>
                        <div class="char-label">ã‚«ã‚¿ã‚«ãƒŠ</div>
                    </div>
                    <div class="char-item">
                        <div class="char-count" id="kanjiCount">0</div>
                        <div class="char-percent" id="kanjiPercent">0%</div>
                        <div class="char-label">æ¼¢å­—</div>
                    </div>
                    <div class="char-item">
                        <div class="char-count" id="alphaNumCount">0</div>
                        <div class="char-percent" id="alphaNumPercent">0%</div>
                        <div class="char-label">è‹±æ•°å­—</div>
                    </div>
                    <div class="char-item">
                        <div class="char-count" id="symbolCount">0</div>
                        <div class="char-percent" id="symbolPercent">0%</div>
                        <div class="char-label">è¨˜å·</div>
                    </div>
                    <div class="char-item">
                        <div class="char-count" id="spaceCount">0</div>
                        <div class="char-percent" id="spacePercent">0%</div>
                        <div class="char-label">ç©ºç™½ãƒ»æ”¹è¡Œ</div>
                    </div>
                </div>
            <div class="word-analysis">
                <h3>å˜èªåˆ†æï¼ˆSEOç”¨ï¼‰</h3>
                <div class="word-controls">
                    <label>æœ€å°æ–‡å­—æ•°: <input type="number" id="minWordLength" value="2" min="1" max="10"></label>
                    <label>è¡¨ç¤ºä»¶æ•°: <input type="number" id="maxWords" value="20" min="5" max="100"></label>
                    <label>ã‚½ãƒ¼ãƒˆ: 
                        <select id="sortOrder">
                            <option value="count">å‡ºç¾å›æ•°é †</option>
                            <option value="percent">å‰²åˆé †</option>
                            <option value="alphabetical">ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †</option>
                        </select>
                    </label>
                </div>
                <div class="word-list" id="wordList">
                    <div class="no-words">ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨å˜èªåˆ†æãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const textInput = document.getElementById('textInput');
        const clearBtn = document.getElementById('clearBtn');
        
        // ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£è¦ç´ 
        const fileDropArea = document.getElementById('fileDropArea');
        const fileSelectBtn = document.getElementById('fileSelectBtn');
        const fileInput = document.getElementById('fileInput');
        const fileStatus = document.getElementById('fileStatus');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentFile = document.getElementById('currentFile');

        // åŸºæœ¬çµ±è¨ˆè¡¨ç¤ºè¦ç´ ã®å–å¾—
        const totalChars = document.getElementById('totalChars');
        const noSpaceChars = document.getElementById('noSpaceChars');
        const noBreakChars = document.getElementById('noBreakChars');
        const lineCount = document.getElementById('lineCount');
        const byteCount = document.getElementById('byteCount');
        const readTime = document.getElementById('readTime');

        // æ–‡å­—ç¨®åˆ¥è¡¨ç¤ºè¦ç´ ã®å–å¾—
        const hiraganaCount = document.getElementById('hiraganaCount');
        const hiraganaPercent = document.getElementById('hiraganaPercent');
        const katakanaCount = document.getElementById('katakanaCount');
        const katakanaPercent = document.getElementById('katakanaPercent');
        const kanjiCount = document.getElementById('kanjiCount');
        const kanjiPercent = document.getElementById('kanjiPercent');
        const alphaNumCount = document.getElementById('alphaNumCount');
        const alphaNumPercent = document.getElementById('alphaNumPercent');
        const symbolCount = document.getElementById('symbolCount');
        const symbolPercent = document.getElementById('symbolPercent');
        const spaceCount = document.getElementById('spaceCount');
        const spacePercent = document.getElementById('spacePercent');

        // å˜èªåˆ†æè¡¨ç¤ºè¦ç´ ã®å–å¾—
        const wordList = document.getElementById('wordList');
        const minWordLength = document.getElementById('minWordLength');
        const maxWords = document.getElementById('maxWords');
        const sortOrder = document.getElementById('sortOrder');

        // æ–‡å­—ç¨®åˆ¥ã®æ­£è¦è¡¨ç¾
        const REGEX = {
            hiragana: /[ã²-ã‚–]/g,
            katakana: /[ã‚¢-ãƒ¾]/g,
            kanji: /[ä¸€-é¾¯]/g,
            alphaNum: /[A-Za-z0-9]/g,
            symbol: /[^\w\s\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,
            space: /[\s\n\r\t]/g
        };

        // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
        function calculatePercentage(count, total) {
            return total > 0 ? Math.round((count / total) * 100) : 0;
        }

        // PDF.jsã¨Mammoth.jsã®å‹•çš„èª­ã¿è¾¼ã¿ã¨è¨­å®š
        let pdfLib = null;
        let mammothLib = null;
        let pdfLibLoading = false;
        let mammothLibLoading = false;

        async function loadPDFJS() {
            if (pdfLib) return pdfLib;
            if (pdfLibLoading) {
                // èª­ã¿è¾¼ã¿ä¸­ã®å ´åˆã¯å¾…æ©Ÿ
                while (pdfLibLoading) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                return pdfLib;
            }

            pdfLibLoading = true;
            
            try {
                // PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®pdfjsLibãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿ
                let attempts = 0;
                while (!window.pdfjsLib && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (!window.pdfjsLib) {
                    throw new Error('PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }

                // ãƒ¯ãƒ¼ã‚«ãƒ¼ã®è¨­å®š
                window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                
                pdfLib = window.pdfjsLib;
                console.log('PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                
            } catch (error) {
                console.error('PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                throw new Error('PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚PDFãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã¯ã§ãã¾ã›ã‚“ã€‚');
            } finally {
                pdfLibLoading = false;
            }

            return pdfLib;
        }

        async function loadMammothJS() {
            if (mammothLib) return mammothLib;
            if (mammothLibLoading) {
                // èª­ã¿è¾¼ã¿ä¸­ã®å ´åˆã¯å¾…æ©Ÿ
                while (mammothLibLoading) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                return mammothLib;
            }

            mammothLibLoading = true;
            
            try {
                // Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js';
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®mammothãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿ
                let attempts = 0;
                while (!window.mammoth && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (!window.mammoth) {
                    throw new Error('Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                mammothLib = window.mammoth;
                console.log('Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                
            } catch (error) {
                console.error('Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
                throw new Error('Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Wordãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã¯ã§ãã¾ã›ã‚“ã€‚');
            } finally {
                mammothLibLoading = false;
            }

            return mammothLib;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
        function checkFileSize(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            return file.size <= maxSize;
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’äººé–“ãŒèª­ã‚ã‚‹å½¢å¼ã«å¤‰æ›
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // é€²æ—è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateProgress(percentage, message = '') {
            progressFill.style.width = percentage + '%';
            if (message) {
                fileStatus.textContent = message;
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function showFileStatus(message, type = 'processing') {
            fileStatus.textContent = message;
            fileStatus.className = `file-status ${type}`;
            
            if (type === 'processing') {
                progressBar.style.display = 'block';
            } else {
                progressBar.style.display = 'none';
            }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                
                reader.onerror = function() {
                    reject(new Error('ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                };
                
                // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è‡ªå‹•åˆ¤å®šã‚’è©¦è¡Œ
                try {
                    reader.readAsText(file, 'UTF-8');
                } catch (error) {
                    reader.readAsText(file, 'Shift-JIS');
                }
            });
        }

        // Wordãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function readWordFile(file) {
            // Mammoth.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
            const mammoth = await loadMammothJS();
            
            const arrayBuffer = await file.arrayBuffer();
            
            try {
                // ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’æŠ½å‡ºï¼ˆæ›¸å¼ã¯ç„¡è¦–ï¼‰
                const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                
                if (result.messages && result.messages.length > 0) {
                    console.log('Wordå‡¦ç†ä¸­ã®è­¦å‘Š:', result.messages);
                }
                
                return result.value.trim();
            } catch (error) {
                throw new Error(`Wordãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }
        async function readPDFFile(file) {
            // PDF.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
            const pdfjsLib = await loadPDFJS();
            
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            
            let fullText = '';
            const totalPages = pdf.numPages;
            
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                updateProgress((pageNum / totalPages) * 100, `PDFã‚’è§£æä¸­... (${pageNum}/${totalPages}ãƒšãƒ¼ã‚¸)`);
                
                const page = await pdf.getPage(pageNum);
                const textContent = await page.getTextContent();
                
                // ãƒ†ã‚­ã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’çµåˆ
                const pageText = textContent.items
                    .map(item => item.str)
                    .join(' ')
                    .replace(/\s+/g, ' ') // è¤‡æ•°ã®ç©ºç™½ã‚’1ã¤ã«
                    .trim();
                
                if (pageText) {
                    fullText += pageText + '\n\n';
                }
            }
            
            return fullText.trim();
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°
        async function processFiles(files) {
            if (!files || files.length === 0) return;
            
            let combinedText = '';
            let processedFiles = [];
            let errorFiles = [];
            
            showFileStatus('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ä¸­...', 'processing');
            updateProgress(0);
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                try {
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
                    if (!checkFileSize(file)) {
                        errorFiles.push(`${file.name}: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ10MBã‚’è¶…ãˆã¦ã„ã¾ã™ (${formatFileSize(file.size)})`);
                        continue;
                    }
                    
                    updateProgress((i / files.length) * 100, `${file.name} ã‚’å‡¦ç†ä¸­...`);
                    
                    let fileText = '';
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    
                    if (fileExtension === 'txt') {
                        fileText = await readTextFile(file);
                    } else if (fileExtension === 'pdf') {
                        fileText = await readPDFFile(file);
                    } else if (fileExtension === 'docx') {
                        fileText = await readWordFile(file);
                    } else {
                        errorFiles.push(`${file.name}: å¯¾å¿œã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™`);
                        continue;
                    }
                    
                    if (fileText.trim()) {
                        combinedText += fileText + '\n\n';
                        processedFiles.push(`${file.name} (${formatFileSize(file.size)})`);
                    } else {
                        errorFiles.push(`${file.name}: ãƒ†ã‚­ã‚¹ãƒˆãŒæŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸ`);
                    }
                    
                } catch (error) {
                    console.error('ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                    errorFiles.push(`${file.name}: ${error.message}`);
                }
            }
            
            // çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è¨­å®š
            if (combinedText.trim()) {
                textInput.value = combinedText.trim();
                countCharacters();
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                let successMessage = `âœ… ${processedFiles.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
                if (processedFiles.length > 0) {
                    successMessage += `\nğŸ“ ${processedFiles.join(', ')}`;
                }
                
                showFileStatus(successMessage, 'success');
                
                // ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
                currentFile.textContent = `èª­ã¿è¾¼ã¿æ¸ˆã¿: ${processedFiles.join(', ')}`;
                currentFile.style.display = 'block';
            }
            
            // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            if (errorFiles.length > 0) {
                const errorMessage = `âŒ ã‚¨ãƒ©ãƒ¼:\n${errorFiles.join('\n')}`;
                if (processedFiles.length === 0) {
                    showFileStatus(errorMessage, 'error');
                } else {
                    // éƒ¨åˆ†çš„æˆåŠŸã®å ´åˆã€æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿½åŠ 
                    const currentMessage = fileStatus.textContent;
                    showFileStatus(currentMessage + '\n\n' + errorMessage, 'success');
                }
            }
            
            updateProgress(100, 'å‡¦ç†å®Œäº†');
        }

        // å˜èªã‚’æŠ½å‡ºã—ã¦è§£æã™ã‚‹é–¢æ•°
        function analyzeWords(text) {
            if (!text.trim()) {
                return [];
            }

            // ãƒ†ã‚­ã‚¹ãƒˆã‚’å˜èªã«åˆ†å‰²ï¼ˆæ—¥æœ¬èªã¨è‹±èªã®æ··åœ¨ã«å¯¾å¿œï¼‰
            const words = [];
            
            // è‹±å˜èªã®æŠ½å‡º
            const englishWords = text.match(/[A-Za-z]+/g) || [];
            words.push(...englishWords);
            
            // æ—¥æœ¬èªã®å˜èªæŠ½å‡ºï¼ˆæ‹¡å¼µç‰ˆï¼šã‚ˆã‚ŠåŒ…æ‹¬çš„ãªæ—¥æœ¬èªæ–‡å­—ç¯„å›²ï¼‰
            const japaneseWords = text.match(/[ã²-ã‚–ã‚¡-ãƒ¾ãƒ¼ä¸€-é¾¯ã€…ã€†ã€¤ãƒ½ãƒ¾ã‚ã‚]+/g) || [];
            words.push(...japaneseWords);
            
            // æ•°å­—ã®æŠ½å‡º
            const numbers = text.match(/[0-9]+/g) || [];
            words.push(...numbers);

            // æ–‡å­—æ•°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const minLength = parseInt(minWordLength.value) || 2;
            const filteredWords = words.filter(word => word.length >= minLength);

            // å˜èªã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const wordCount = {};
            filteredWords.forEach(word => {
                const lowerWord = word.toLowerCase(); // è‹±èªã®å¤§æ–‡å­—å°æ–‡å­—ã‚’çµ±ä¸€
                wordCount[lowerWord] = (wordCount[lowerWord] || 0) + 1;
            });

            // ç·å˜èªæ•°ã‚’è¨ˆç®—
            const totalWords = Object.values(wordCount).reduce((sum, count) => sum + count, 0);

            // é…åˆ—ã«å¤‰æ›ã—ã¦ã‚½ãƒ¼ãƒˆ
            const wordArray = Object.entries(wordCount).map(([word, count]) => ({
                word,
                count,
                percent: ((count / totalWords) * 100).toFixed(1)
            }));

            // ã‚½ãƒ¼ãƒˆ
            const sort = sortOrder.value;
            wordArray.sort((a, b) => {
                if (sort === 'count') {
                    return b.count - a.count;
                } else if (sort === 'percent') {
                    return parseFloat(b.percent) - parseFloat(a.percent);
                } else if (sort === 'alphabetical') {
                    return a.word.localeCompare(b.word);
                }
                return 0;
            });

            // è¡¨ç¤ºä»¶æ•°åˆ¶é™
            const maxCount = parseInt(maxWords.value) || 20;
            return wordArray.slice(0, maxCount);
        }

        // å˜èªåˆ†æçµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayWordAnalysis(wordData) {
            if (!wordData || wordData.length === 0) {
                wordList.innerHTML = '<div class="no-words">åˆ†æå¯¾è±¡ã®å˜èªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
                return;
            }

            const html = wordData.map(item => `
                <div class="word-item">
                    <span class="word-text">${item.word}</span>
                    <div class="word-stats">
                        <span class="word-count">${item.count}å›</span>
                        <span class="word-percent">${item.percent}%</span>
                    </div>
                </div>
            `).join('');

            wordList.innerHTML = html;
        }

        // æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹é–¢æ•°
        function countCharacters() {
            const text = textInput.value;
            
            // åŸºæœ¬ã‚«ã‚¦ãƒ³ãƒˆ
            const total = text.length;
            const noSpace = text.replace(/\s/g, '').length;
            const noBreak = text.replace(/\n/g, '').length;
            const lines = text.split('\n').length;
            
            // ãƒã‚¤ãƒˆæ•°è¨ˆç®—ï¼ˆUTF-8ï¼‰
            const bytes = new Blob([text]).size;
            
            // èª­äº†æ™‚é–“è¨ˆç®—ï¼ˆå¹³å‡400æ–‡å­—/åˆ†ï¼‰
            const readMinutes = Math.ceil(noSpace / 400);
            
            // æ–‡å­—ç¨®åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
            const hiragana = (text.match(REGEX.hiragana) || []).length;
            const katakana = (text.match(REGEX.katakana) || []).length;
            const kanji = (text.match(REGEX.kanji) || []).length;
            const alphaNum = (text.match(REGEX.alphaNum) || []).length;
            const symbol = (text.match(REGEX.symbol) || []).length;
            const space = (text.match(REGEX.space) || []).length;
            
            // åŸºæœ¬çµ±è¨ˆã®è¡¨ç¤º
            totalChars.textContent = total;
            noSpaceChars.textContent = noSpace;
            noBreakChars.textContent = noBreak;
            lineCount.textContent = lines;
            byteCount.textContent = bytes;
            readTime.textContent = readMinutes;
            
            // æ–‡å­—ç¨®åˆ¥ã®è¡¨ç¤º
            hiraganaCount.textContent = hiragana;
            hiraganaPercent.textContent = calculatePercentage(hiragana, total) + '%';
            
            katakanaCount.textContent = katakana;
            katakanaPercent.textContent = calculatePercentage(katakana, total) + '%';
            
            kanjiCount.textContent = kanji;
            kanjiPercent.textContent = calculatePercentage(kanji, total) + '%';
            
            alphaNumCount.textContent = alphaNum;
            alphaNumPercent.textContent = calculatePercentage(alphaNum, total) + '%';
            
            symbolCount.textContent = symbol;
            symbolPercent.textContent = calculatePercentage(symbol, total) + '%';
            
            spaceCount.textContent = space;
            spacePercent.textContent = calculatePercentage(space, total) + '%';
            
            // å˜èªåˆ†æã®å®Ÿè¡Œã¨è¡¨ç¤º
            const wordData = analyzeWords(text);
            displayWordAnalysis(wordData);
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆé–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºï¼‰
            console.log('åˆ†æçµæœ:', {
                åŸºæœ¬: { total, noSpace, noBreak, lines, bytes, readMinutes },
                æ–‡å­—ç¨®åˆ¥: { hiragana, katakana, kanji, alphaNum, symbol, space },
                å˜èªåˆ†æ: wordData.slice(0, 5) // ä¸Šä½5ä»¶ã®ã¿è¡¨ç¤º
            });
        }

        // å˜èªåˆ†æè¨­å®šå¤‰æ›´æ™‚ã®å‡¦ç†
        function onWordSettingsChange() {
            countCharacters(); // å†åˆ†æã‚’å®Ÿè¡Œ
        }

        // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®å‡¦ç†
        function clearText() {
            textInput.value = '';
            countCharacters();
            textInput.focus();
            
            // ãƒ•ã‚¡ã‚¤ãƒ«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            fileStatus.className = 'file-status';
            progressBar.style.display = 'none';
            currentFile.style.display = 'none';
            fileInput.value = '';
            
            console.log('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
        function handleDragOver(e) {
            e.preventDefault();
            fileDropArea.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            fileDropArea.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            fileDropArea.classList.remove('drag-over');
            
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        textInput.addEventListener('input', countCharacters);
        clearBtn.addEventListener('click', clearText);

        // ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        fileDropArea.addEventListener('dragover', handleDragOver);
        fileDropArea.addEventListener('dragleave', handleDragLeave);
        fileDropArea.addEventListener('drop', handleDrop);
        fileDropArea.addEventListener('click', () => fileInput.click());
        fileSelectBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);

        // å˜èªåˆ†æè¨­å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        minWordLength.addEventListener('change', onWordSettingsChange);
        maxWords.addEventListener('change', onWordSettingsChange);
        sortOrder.addEventListener('change', onWordSettingsChange);

        // åˆæœŸå®Ÿè¡Œ
        countCharacters();
        
        console.log('æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ï¼ˆtxt/PDF/Wordå¯¾å¿œç‰ˆï¼‰ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
    </script>
</body>
</html>